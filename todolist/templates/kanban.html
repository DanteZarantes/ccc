<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kanban Board</title>
    <style>
        /* Основной контейнер страницы (у вас уже есть .main-content в header.html,
           но если нужно отдельный блок, оставляем этот класс) */
        .main-content {
            margin-top: 80px; /* чтобы не залезать под фиксированный хедер */
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        /* Контейнер для всех колонок (To-Do, In Progress, Done) */
        .board-container {
            display: flex;
            gap: 20px;
            margin: 0 auto; /* центрируем по горизонтали */
            max-width: 1200px; /* ограничиваем ширину */
            padding: 20px;
        }

        /* Каждая колонка */
        .column {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-height: 500px;
            transition: transform 0.2s;
            position: relative;
        }
        .column:hover {
            transform: translateY(-3px);
        }
        .column h3 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.3rem;
            color: #333;
        }

        /* Карточки задач */
        .task {
            background: #fff;
            margin: 8px 0;
            padding: 10px 14px;
            border-radius: 6px;
            border: 1px solid #ddd;
            color: #333; /* тёмный текст */
            cursor: move;
            transition: background 0.3s, transform 0.2s;
        }
        .task:hover {
            background: #f7f7f7;
            transform: scale(1.02);
        }

        /* Статистика задач (опционально) */
        .task-count {
            text-align: center;
            margin: 15px 0 25px;
            font-size: 1rem;
            color: #fff;
        }

        /* Краткое описание */
        .kanban-intro {
            text-align: center;
            max-width: 700px;
            margin: 0 auto 20px;
            font-size: 1.1rem;
            color: #fff;
            line-height: 1.4;
        }
    </style>
</head>

<!--
     Класс body у вас уже определяется через header.html (theme),
     так что мы предполагаем, что вы используете:
     <body class="{% if request.session.theme %}{{ request.session.theme }}{% else %}gradient{% endif %}">
-->
<body class="{% if request.session.theme %}{{ request.session.theme }}{% else %}gradient{% endif %}">
    <!-- Подключаем ваш общий хедер -->
    {% include 'header.html' %}

    <div class="main-content">
        <h2 style="text-align: center; color: #fff; margin-bottom: 10px;">Kanban Board</h2>

        <p class="kanban-intro">
            Easily manage your tasks by dragging them between columns. Keep track of what needs
            to be done, what's in progress, and what you've successfully completed!
        </p>

        <!-- Небольшая статистика по колонкам (опционально) -->
        <div class="task-count">
            <strong>To-Do:</strong> {{ tasks_todo.count }} &nbsp;|&nbsp;
            <strong>In Progress:</strong> {{ tasks_in_progress.count }} &nbsp;|&nbsp;
            <strong>Done:</strong> {{ tasks_done.count }}
        </div>

        <div class="board-container">
            <!-- To-Do Column -->
            <div class="column" id="todo" ondragover="allowDrop(event)" ondrop="dropTask(event)">
                <h3>To-Do</h3>
                {% for task in tasks_todo %}
                    <div class="task" draggable="true" id="task-{{ task.id }}" ondragstart="dragTask(event)">
                        {{ task.title }}
                    </div>
                {% empty %}
                    <p style="color: #444; font-style: italic;">No tasks</p>
                {% endfor %}
            </div>

            <!-- In Progress Column -->
            <div class="column" id="in_progress" ondragover="allowDrop(event)" ondrop="dropTask(event)">
                <h3>In Progress</h3>
                {% for task in tasks_in_progress %}
                    <div class="task" draggable="true" id="task-{{ task.id }}" ondragstart="dragTask(event)">
                        {{ task.title }}
                    </div>
                {% empty %}
                    <p style="color: #444; font-style: italic;">No tasks</p>
                {% endfor %}
            </div>

            <!-- Done Column -->
            <div class="column" id="done" ondragover="allowDrop(event)" ondrop="dropTask(event)">
                <h3>Done</h3>
                {% for task in tasks_done %}
                    <div class="task" draggable="true" id="task-{{ task.id }}" ondragstart="dragTask(event)">
                        {{ task.title }}
                    </div>
                {% empty %}
                    <p style="color: #444; font-style: italic;">No tasks</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
    function allowDrop(ev) {
      ev.preventDefault();
    }

    function dragTask(ev) {
      ev.dataTransfer.setData("text", ev.target.id);
    }

    function dropTask(ev) {
      ev.preventDefault();
      const data = ev.dataTransfer.getData("text");
      const taskElement = document.getElementById(data);
      const dropColumn = ev.target.closest('.column');
      if (!dropColumn) return;

      dropColumn.appendChild(taskElement);

      // Determine new status based on the column's ID
      const newStatus = dropColumn.id; // 'todo', 'in_progress', or 'done'
      const taskId = data.split('-')[1];

      fetch("{% url 'update_task_status' %}", {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ task_id: taskId, status: newStatus })
      })
      .then(response => response.json())
      .then(data => {
        if (!data.success) {
          alert('Failed to update task status.');
        }
      })
      .catch(error => console.error('Error:', error));
    }
    </script>
</body>
</html>
